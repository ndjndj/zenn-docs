---
title: "ã€Dockerã€‘1 å°ã® EC2 ã§ RDB ã‚‚ Nginx ã‚‚ Rails ã‚‚å‹•ã‹ã™"
emoji: "ğŸ…°ï¸"
type: "tech"
topics:
  - "aws"
  - "docker"
  - "ec2"
published: true
published_at: "2024-01-26 14:10"
---

Rails ã§ API ã‚’é–‹ç™ºã—ã¦ã„ã¾ã™ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰å‘¼ã³å‡ºã—ãŸããªã£ãŸã®ã§ã™ãŒã€ç¾æ™‚ç‚¹ã§ RDS ã ã£ãŸã‚Š VPC ã ã£ãŸã‚Šè¨­å®šã™ã‚‹ã®ãŒã¡ã‚‡ã£ã¨ã‚ã‚“ã©ã†ã ã£ãŸã®ã§ã€ã¨ã‚Šã‚ãˆãšæ¤œè¨¼ç”¨ã¨ã—ã¦ã€ EC2 ã« Docker ç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¦å…¨éƒ¨å…¥ã‚Šã® Rails ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¾ã—ãŸã€‚

# æµã‚Œ
0. å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã‚’ç”¨æ„ã™ã‚‹
1. EC2 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®æº–å‚™
2. EC2 ã§å‹•ã‹ã™ãŸã‚ã«ãƒ­ãƒ¼ã‚«ãƒ«ã§è¡Œã†ä½œæ¥­
3. EC2 ã§ DockerImage ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠç¾¤ã‚’ç«‹ã¡ä¸Šã’ã‚‹

# ã²ãªå‹

https://github.com/ndjndj/rails-ec2-verification

# 0. å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã‚’ç”¨æ„ã™ã‚‹  

ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```
.
â”œâ”€ compose.verification.yml
â”œâ”€ nginx
|   â”œâ”€ Dockerfile.verification
|   â””â”€ nginx.conf
â””â”€ rails
    â”œâ”€ app
    â”œâ”€ bin
    â”œâ”€ config
    â”œâ”€ ...(ä»– Rails ã§å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ç¾¤)
    â”œâ”€ Gemfile
    â”œâ”€ Gemfile.lock
    â”œâ”€ Dockerfile.verification
    â””â”€ entrypoint.verification.sh
```

ä»¥ä¸‹ã®ã©ã¡ã‚‰ã‹ã§æ“ä½œã§ /rails ç›´ä¸‹ã« RailsApp ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ç¾¤ã‚’è¨­ç½®ã™ã‚‹ã€‚

- ( é¸æŠè‚¢ 1 ) ã‚µãƒ³ãƒ—ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã—ã¦æ–°ã—ã„ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œã‚Šã€æ—¢å­˜ã® Rails App ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã‚‹

    ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å ´åˆã€ä»¥ä¸‹ã®ä½œæ¥­ãŒå¿…è¦

    - ä¸‹è¨˜ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›¸ãæ›ãˆ
        1. YourRailsApp/config/puma.rb 
        2. YourRailsApp/environments/development.rb
    - YourRailsApp/ ã«ä¸‹è¨˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ _rails/ ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ã¦ãã‚‹
        1. _rails/Dockerfile.verification 
        2. _rails/entrypoint.verification.sh 
    - compose.verification.yml ã‚’é©å®œæ›¸ãæ›ãˆã‚‹

- ( é¸æŠè‚¢ 2 ) ã‚µãƒ³ãƒ—ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã—ã¦æ–°ã—ã„ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œã‚Šã€æ–°è¦ Rails App ã®é–‹ç™ºã‚’é–‹å§‹ã™ã‚‹

    1. ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ RailsApp ã®é–‹ç™ºã‚’é–‹å§‹ã™ã‚‹
	rails new ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯é©å®œå¤‰æ›´ã—ã¦ãã ã•ã„ã€‚
	ä¸‹è¨˜ã¯ API ãƒ¢ãƒ¼ãƒ‰ã§ä½œæˆã—ã¦ã„ã¾ã™ã€‚
        ```bash
        docker compose run --rm rails rails new . --skip --database=postgresql --api --skip-bundle
        ```

    2. /rails/.git ã¯å‰Šé™¤ã—ã¦ãŠã

# 1. EC2 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®æº–å‚™

ä½¿ç”¨ã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«é–¢ã™ã‚‹æƒ…å ±ã¯ä¸‹è¨˜ã®ã¨ãŠã‚Šã§ã™ã€‚  
æ¤œè¨¼ã—ãŸã¨ã“ã‚ã€nginx + Ruby on Rails + Postgresql ãªã‚‰ t2.micro ã§ååˆ†ã§ã—ãŸãŒã€ã“ã“ã¯é©å®œå¤‰æ›´ã—ã¦ãã ã•ã„ã€‚  
ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«é–¢ã—ã¦ã‚‚ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚µã‚¤ã‚ºã«å¿œã˜ã¦å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚  
ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã¯ã€ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ã® SSH ã¨ HTTP ã‚’è¨±å¯ã™ã‚‹è¨­å®šã«ã—ã¦ãã ã•ã„ã€‚

|name|value|
|-|-|
|ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—|t2.micro|
|AMI|Ubuntu|
|ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸|20GB|


## 1-1. Docker CE ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹

SSH ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ãªã‚Šã—ã¦ã€EC2 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã« Docker CE ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚  

```bash
# å¤ã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å‰Šé™¤
sudo apt-get remove docker docker-engine docker.io containerd runc
# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æ›´æ–°
sudo apt-get update
# é–¢é€£ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt-get install ca-certificates curl gnupg lsb-release
# Docker ã® GPG ã‚­ãƒ¼(æš—å·åŒ–ãƒ„ãƒ¼ãƒ«ã®ã‚­ãƒ¼)ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
sudo chmod a+r /etc/apt/keyrings/docker.gpg

# Docker ã®ãƒªãƒã‚¸ãƒˆãƒªæƒ…å ±ã‚’ apt ã«è¿½åŠ ã—ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# ç¢ºèªã¨æ›´æ–°
sudo apt-get update
# Docker CE ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin

# docker ã¨ã„ã†ã‚°ãƒ«ãƒ¼ãƒ—ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ ã™ã‚‹
# â€»è‡ªå‹•çš„ã«è¿½åŠ ã•ã‚Œã¦ã„ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™
sudo groupadd docker

# ç¾åœ¨ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ docker ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ ã™ã‚‹
sudo usermod -aG docker $USER
```

# 2. EC2 ã§å‹•ã‹ã™ãŸã‚ã«ãƒ­ãƒ¼ã‚«ãƒ«ã§è¡Œã†ä½œæ¥­

## 2-1. ruby file ã®æ›¸ãæ›ãˆ

æ—¢ã«ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ nginx ã¨é€šä¿¡ã™ã‚‹ãŸã‚ã«è¨­å®šã‚’å¤‰æ›´ã—ã¦ã„ãã€‚  

_rails/config/puma.rb ã‚’å‚è€ƒã«ã€config/puma.rb ã‚’æ›¸ãæ›ãˆã‚‹ã€‚  
ãƒã‚¤ãƒ³ãƒˆã¯ã€Port ã®è¨­å®šã‚’ç„¡åŠ¹ã«ã™ã‚‹ã“ã¨ã¨ã€nginx ã®è¨­å®šã‚’ bind ã•ã›ã‚‹ã“ã¨  

**config/puma.rb**
```rb
# config/puma.rb
# port è¨­å®šã‚’ç„¡åŠ¹ã«ã™ã‚‹
# port ENV.fetch("PORT") { 3000 }

# -------------ä¸­ç•¥-------------

# nginx ã®è¨­å®šã‚’ bind ã•ã›ã‚‹
app_root = File.expand_path("..", __dir__)
bind "unix://#{app_root}/tmp/sockets/puma.sock"
```

ã¾ãŸã€ãƒ›ã‚¹ãƒˆã®è¨±å¯è¨­å®šã‚‚è¿½åŠ ã™ã‚‹

**config/environments/development.rb**
```rb 
# config/environments/development.rb 

# -------------ä¸­ç•¥-------------
config.hosts << "<ec2 ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IPv4 DNS>"
```

## 2-2. DockerImage ã® build

```bash
docker compose -f compose.verification.yml build --no-cache
```

## 2-3. è©¦ã—ã« up ã‚‚ã—ã¦ã¿ã‚‹

```bash
docker compose -f compose.verification.yml up
```

## 2-4. EC2 ã«é€ã‚‹ã‚½ãƒ¼ã‚¹ä¸€å¼ã‚’åœ§ç¸®ã™ã‚‹

ä»»æ„ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®åœ§ç¸®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚  
ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ EC2 ã«é€ä¿¡ã€EC2 ã§è§£å‡ã—ã¾ã™ã€‚  
ä»Šå›ã¯ã€rails-ec2-verification/ ã§ãƒªãƒã‚¸ãƒˆãƒªã”ã¨åœ§ç¸®ã—ã¦ã„ã¾ã™ã€‚

```bash
tar zcvf app.tar.gz ./
```

## 2-5. EC2 ã«é€ã‚‹ã‚ˆã†ã« DockerImage ã‚’ tar ãƒ•ã‚¡ã‚¤ãƒ«ã«å¤‰æ›ã™ã‚‹

nginx, Postgresql, rails ã® DockerImage ã‚’ tar å½¢å¼ã§ save ã—ã¾ã™ã€‚  
ãã®å¾Œã€EC2 ã«è»¢é€ã™ã‚‹ãŸã‚ã« gzip å½¢å¼ã§ã®åœ§ç¸®ã‚‚è¡Œã„ã¾ã™ã€‚

```
# å¯¾è±¡ã® DockerImage ã® ImageID ã‚’ç‰¹å®šã™ã‚‹
docker images 

# ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
mkdir docker-images 
cd docker-images 
docker save <nginx image ID> > nginx.tar
docker save <postgresql image ID> > postgres.tar
docker save <rails image ID> > rails.tar

# åœ§ç¸®
tar zcvf docker-images.tar.gz ./
```

ã“ã®æ–¹æ³•ã‚’ä½¿ã‚ãªã„å ´åˆã¯ã€ã€Œ3-2. Rails App ã‚’è§£å‡ã€ã¾ã§ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚  

ãŸã ã€EC2 ã®ä¸­ã§ build ã‚’ã—ã¦ã‚‚ã„ã„ã®ã§ã™ãŒã€gem ã®ã‚µã‚¤ã‚ºã«ã‚ˆã£ã¦ã¯ bundle install ã‚’ã—ã¦ã„ã‚‹ã¨ãã«ãƒã‚·ãƒ³ã® CPU ãƒªã‚½ãƒ¼ã‚¹ãŒæ¯æ¸‡ã—ã¦ã—ã¾ã†å ´åˆãŒã‚ã‚Šã¾ã™ã€‚  
ãªã®ã§ã€è»¢é€ã«æ™‚é–“ãŒã‹ã‹ã£ã¦ã—ã¾ã„ã¾ã™ãŒã€DockerImage ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã§ä½œã£ã¦ã—ã¾ã†ã“ã¡ã‚‰ã®æ–¹æ³•ã®æ–¹ãŒãŠã™ã™ã‚ã§ã™ã€‚  


## 2-6. compose.verification.yml ã® build å¯¾è±¡ã‚’å¤‰æ›´ã™ã‚‹
    
ä¸‹è¨˜ã®ã‚ˆã†ã«ã€DockerImage ã‹ã‚‰ build ã™ã‚‹ã‚ˆã†ã«è¨­å®šã‚’å¤‰æ›´ã—ã¾ã™ã€‚  

DockerImage ã® Image IDã€ã‚‚ã—ãã¯ Repository:tag ã‚’èª¿ã¹ã¾ã™ã€‚
```bash
docker images
```
compose.verification.yml ã®è¨­å®šã‚’å¤‰æ›´ã—ã¾ã™ã€‚
```yaml
version: '3'
services: 
web: 
db:
rails: 
image: <image ID or repository:tag>
# image: xxxxxxxxxxx ID 
# image: raisl-ec2-verificaiton-rails:latest 
#build: 
#  context: ./rails
#  dockerfile: ./Dockerfile.verification
command: bash -c "rails s -b '0.0.0.0'"
volumes:
  - ./rails:/usr/src/app
  - tmp-d:/usr/src/app/tmp
depends_on:
  - db 
tty: true 
stdin_open: true
volumes: 
pg-data:
tmp-d: 
bin: 
driver: local
```

## 2-7. EC2 ã« DockerImage ã‚’é€ä¿¡ã™ã‚‹

ã‚­ãƒ¼ãƒšã‚¢ã®æŒ‡å®šã¨ãƒ‘ã‚¹ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚  
ã¾ãŸ WSL ãªã©ã§ ãƒ›ã‚¹ãƒˆã‚’ãƒã‚¦ãƒ³ãƒˆã—ã¦ã„ã‚‹å ´åˆã¯ã€permission error ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚  
ãã®å ´åˆã¯ã€ãƒ›ã‚¹ãƒˆå´ã‹ã‚‰é€ä¿¡ã™ã‚‹æ–¹æ³•ã‚„ã€WSL å´ã« pem ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç§»å‹•ã—ãŸã†ãˆã§æ¨©é™å¤‰æ›´ãªã©ã®æ–¹æ³•ã‚’è©¦ã—ã¦ãã ã•ã„ã€‚  

https://qiita.com/ShortArrow/items/404c60c6a11f114f0f4f

```
scp -i <pem ãƒ•ã‚¡ã‚¤ãƒ«> -r ../docker-images.tar.gz ubuntu@<ip>:/home/ubuntu/
scp -i <pem ãƒ•ã‚¡ã‚¤ãƒ«> -r ./app.tar.gz ubuntu@<ip>:/home/ubuntu/
```

# 3. EC2 ã§ DockerImage ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠç¾¤ã‚’ç«‹ã¡ä¸Šã’ã‚‹

## 3-1. DockerImage ã®è¨­å®š

DockerImage ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚  
ã¾ãŸã€repository ã¨ tag ãŒ none ã«ãªã£ã¦ã„ã‚‹ã®ã§ã€ã‚¿ã‚°ä»˜ã‘ã‚‚ã—ã¾ã™ã€‚  
compose.yml ã§ image ID ã‚’æŒ‡å®šã—ã¦ã„ã‚‹å ´åˆã¯ç„¡è¦–ã—ã¦ãã ã•ã„ã€‚

```bash
# è§£å‡
tar zxvf docker-images.tar.gz

# load 
docker load < docker-images/nginx.tar
docker load < docker-images/postgres.tar
docker load < docker-images/rails.tar

# ã‚¿ã‚°ã¥ã‘
docker images 
# compose.yml ã§æŒ‡å®šã—ãŸã‚¿ã‚°ã‚’è¨­å®šã™ã‚‹
docker tag xxxxxxxx rails-ec2-verification-rails:latest
docker tag xxxxxxxx rails-ec2-verification-web:latest
```

## 3-2. Rails App ã‚’è§£å‡
Rails Application ã®ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ compose.yml ã‚’ä»»æ„ã®å ´æ‰€ã«ç§»å‹•ã—ã¾ã™

```bash
sudo su -
cd /
mv /home/ubuntu/app.tar.gz /usr/src/app.tar.gz
cd usr/src 
tar zxvf /usr/src/app.tar.gz
```

## 3-3. Docker up

```bash
docker compose -f compose.verification.yml up
```

# 4. å‹•ä½œç¢ºèª

ãƒ–ãƒ©ã‚¦ã‚¶ã§ ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IPv4 DNS ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€Rails ã®ã„ã¤ã‚‚ã®ç”»é¢ãŒå‡ºã¦ãã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

# è©°ã¾ã£ãŸã¨ã“ã‚

puma.sock ã‚’ nginx ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰å‚ç…§ã™ã‚‹ã“ã¨ãŒã§ããšã€502 Bad Gateway ã‚’è§£æ±ºã§ãã¾ã›ã‚“ã§ã—ãŸã€‚  
compose ãƒ•ã‚¡ã‚¤ãƒ«ã§ã€åå‰ä»˜ããƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒå¿…è¦ã§ã—ãŸã€‚

https://teratail.com/questions/j5hlwyx137nhis

:::details nginx.conf
```conf
user nginx;
worker_processes auto;

error_log /var/log/nginx/error.log warn;
pid       /var/run/nginx.pid;

events {
    worker_connections 1024;
}

http {
    upstream app {
        # ã‚½ã‚±ãƒƒãƒˆé€šä¿¡ã—ãŸã„ã®ã§ puma.sock ã‚’æŒ‡å®š
        server unix://usr/src/app/tmp/sockets/puma.sock;
    }

    server {
        listen 80;
        # ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚‚ã—ãã¯ IP ã‚’æŒ‡å®š
        server_name localhost; 

        access_log /var/log/nginx/access.log;
        error_log  /var/log/nginx/error.log; 

        # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ«ãƒ¼ãƒˆã®æŒ‡å®š 
        root /usr/src/app/public; 

        proxy_connect_timeout 600;
        proxy_read_timeout    600; 
        proxy_send_timeout    600;

        client_max_body_size            100m;
        error_page 404             /404.html;
        error_page 505 502 503 504 /500.html;
        keepalive_timeout 600;
        location /healthcheck {
            root /usr/share/nginx/html;
            empty_gif; 
            break;
        }

        location / {
            try_files $uri @app;
        }

        # ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·é–¢é€£ã®è¨­å®š
        location @app {
            proxy_set_header X-Real-IP       $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header Host            $http_host; 
            proxy_pass http://app;
        }
    }
}
```
:::

**compose.verification.yml**
```yaml
version: '3'
services: 
  web: 
    #--------ç•¥--------
    volumes: 
      - ./rails:/usr/src/app
      - ./nginx/nginx.conf:/etc/nginx/myapp.conf
      - tmp-d:/usr/src/app/tmp
  db: 
    #--------ç•¥--------
  rails: 
    #--------ç•¥--------
    volumes:
      - ./rails:/usr/src/app
      - tmp-d:/usr/src/app/tmp
    #--------ç•¥--------
volumes: 
  #--------ç•¥--------
  tmp-d: 
  #--------ç•¥--------
```


# ã•ã„ã”ã«
æ¤œè¨¼ç”¨ã« EC2 1å°ã§ Rails ã‚‚ RDB ã‚‚ nginx ã‚‚å‹•ã‹ã—ã¦ã¿ã¾ã—ãŸã€‚
çµæ§‹ã‚ã‚“ã©ãã•ã‹ã£ãŸã§ã™ã­ã€‚
å¤šåˆ†ã‚‚ã£ã¨æ¥½ãªæ–¹æ³•ãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ãŒã€EC2 1å°åˆ†ã®æ–™é‡‘ã—ã‹ã‹ã‹ã‚‰ãªã„ã®ã¨ã‚ã‚“ã©ãã•ã„ã ã‘ã§è¤‡é›‘ãªæ–¹æ³•ã§ã¯ãªã„ç‚¹ã¯ãƒ¡ãƒªãƒƒãƒˆã ã¨æ€ã„ã¾ã™ã€‚
æ¬¡å›ã¯ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç«‹ã¡ä¸Šã’ãŸã‚‰è‡ªå‹•ã§ docker compose up ã§ãã‚‹ã‚ˆã†ã«ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

# å‚è€ƒ
https://qiita.com/koki1720/items/38a626192777b0c82bdb
https://qiita.com/zembutsu/items/9e9d80e05e36e882caaa
https://qiita.com/YuukiMiyoshi/items/306edbfb93de7e5dcec4
https://qiita.com/ShortArrow/items/404c60c6a11f114f0f4f
https://teratail.com/questions/j5hlwyx137nhis