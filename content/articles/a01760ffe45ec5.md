---
title: "Ruby ä»»æ„ã®æ–‡å­—ç¨®ã‚’å«ã‚“ã ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹"
emoji: "ğŸ°"
type: "tech"
topics:
  - "ruby"
published: true
published_at: "2024-04-18 18:06"
---

ä»¥ä¸‹ã®è¦ä»¶ã«æ²¿ã£ã¦ä¸€æ™‚çš„ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€SecureRandom module ã‚’ãã®ã¾ã¾ã§ã¯ä½¿ãˆãªã•ãã†ã ã£ãŸã®ã§å®Ÿç¾æ–¹æ³•ã‚’è€ƒãˆã¦ã¿ã¾ã—ãŸã€‚

- æœ€ä½ n æ–‡å­—
- ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã®å¤§æ–‡å­—ãƒ»å°æ–‡å­—ã€0ï½9 ã®æ•°å­—ã€ã„ãã¤ã‹ã®è¨˜å·ã‚’ãã‚Œãã‚Œ 1 æ–‡å­—ãšã¤å«ã‚€

# çµè«–
- SecureRandom ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã¯æ–‡å­—ã®ç¨®é¡ã‚’ç´°ã‹ãæŒ‡å®šã—ã¦ãƒ©ãƒ³ãƒ€ãƒ ã§æ–‡å­—åˆ—ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã¯ã§ããªã„
- æœ€ä½ n æ–‡å­—ã¨æ–‡å­—ç¨®ã‚’æº€ãŸã™ã¾ã§å„æ–‡å­—ç¨®ã‚’é©å½“ã« pick ã—ã¦ã„ãæ–¹æ³•
- æ¡ä»¶ã®æ–‡å­—ç¨®ã‚’å«ã‚“ã æ–‡å­—åˆ—ã‚’æ¡ä»¶ã‚’æº€ãŸã™ã¾ã§ sample ã™ã‚‹æ–¹æ³•

# æœ€åˆã«è€ƒãˆãŸæ–¹æ³•
æœ€åˆã«è€ƒãˆãŸã®ã¯ã€æ–‡å­—ç¨®ã®é…åˆ—ã‚’ä½œæˆã— sample ãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦ã„ãæ–¹æ³•ã§ã™ã€‚
ã“ã‚“ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã§å®Ÿè£…ã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã—ãŸã€‚

```rb
def generate_password
  chars_lower = ('a'..'z').to_a
  chars_upper = ('A'..'Z').to_a
  chars_number = ('0'..'9').to_a
  chars_special = ['~', '-', '|', '!', '?', '_']

  chars = [*chars_lower, *chars_upper, *chars_number, *chars_special]
  password_length = 8

  while true do
    tmp_password = ''
    is_lower = false
    is_upper = false
    is_number = false
    is_special = false

    # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆ
    password_length.times do
      tmp_password += chars.sample
    end
    # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®è¦ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ã‹ç¢ºèª
    tmp_password.split("").each do |c|
      is_lower = chars_lower.include?(c) ? true : is_lower
      is_upper = chars_upper.include?(c) ? true : is_upper
      is_number = chars_number.include?(c) ? true : is_number
      is_special = chars_special.include?(c) ? true : is_special
    end

    if is_lower && is_upper && is_number && is_special
      return tmp_password
    end
  end
end
```

ãŸã ã€sample ãƒ¡ã‚½ãƒƒãƒ‰ã§ä½¿ç”¨ã—ã¦ã„ã‚‹ä¹±æ•°ç”Ÿæˆå™¨ãŒãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§åˆ©ç”¨ã™ã‚‹ã«ã¯å®‰å…¨ã§ãªã„ã¨ã®ã“ã¨ã‹ã‚‰ã€ã“ã®æ–¹æ³•ã‚’ä½¿ç”¨ã™ã‚‹ã®ã¯è¦‹é€ã‚Šã€SecureRandom ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ãŸæ–¹æ³•ã‚’è€ƒãˆã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚

https://teratail.com/questions/117807

# SecureRandom ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã¯æ–‡å­—ã®ç¨®é¡ã‚’ç´°ã‹ãæŒ‡å®šã—ã¦ãƒ©ãƒ³ãƒ€ãƒ ã§æ–‡å­—åˆ—ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã¯ã§ããªã„
SecureRandom ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã¯ã€ä»Šå›ã®è¦ä»¶ã‚’æº€ãŸã™ã‚ˆã†ãªæ–‡å­—åˆ—ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ãªãœãªã‚‰ã€æ–‡å­—ç¨®ã‚’æŒ‡å®šã—ã¦ãƒ©ãƒ³ãƒ€ãƒ ã«æ–‡å­—åˆ—ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ããªã„ãŸã‚ã§ã™ã€‚
æ–‡å­—åˆ— + æ•°å€¤ã®çµ„ã¿åˆã‚ã›ãªã‚‰ã° `alphanumeric` ãƒ¡ã‚½ãƒƒãƒ‰ãŒä½¿ç”¨ã§ãã¾ã™ãŒã€è¨˜å·ã‚‚å…¥ã‚ŒãŸã„ã¨ãªã‚‹ã¨ä¸€å·¥å¤«å¿…è¦ãã†ã§ã™ã€‚

https://docs.ruby-lang.org/ja/latest/class/SecureRandom.html

# æœ€ä½ n æ–‡å­—ã¨æ–‡å­—ç¨®ã‚’æº€ãŸã™ã¾ã§å„æ–‡å­—ç¨®ã‚’é©å½“ã« pick ã—ã¦ã„ãæ–¹æ³•
`array.sample` ã‚’ä½¿ç”¨ã—ã¦ã„ãŸéƒ¨åˆ†ã‚’ SecureRandom ã® `random_number` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’åˆ©ç”¨ã—ã¦ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æŠ½å‡ºã™ã‚‹æ–¹æ³•ã‚’ä½¿ã„ã¾ã™ã€‚
`random_number` ãƒ¡ã‚½ãƒƒãƒ‰ã¯å¼•æ•°ã‚’æŒ‡å®šã—ãªã‘ã‚Œã° 0 ä»¥ä¸Š 1 æœªæº€ã®æ•°å€¤ã‚’è¿”ã—ã¾ã™ãŒã€å¼•æ•° n ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ 0 ä»¥ä¸Š n æœªæº€ã®æ•°å€¤ã‚’è¿”ã—ã¦ãã‚Œã¾ã™ã€‚

```rb
def generate_password(password_length=8)
  raise ArgumentError if password_length < 4
  
  chars_lower = ('a'..'z').to_a
  chars_upper = ('A'..'Z').to_a
  chars_number = ('0'..'9').to_a
  chars_special = ['~', '-', '|', '!', '?', '_']

  chars = [*chars_lower, *chars_upper, *chars_number, *chars_special]

  while true do
    tmp_password = ''
    is_lower = false
    is_upper = false
    is_number = false
    is_special = false

    # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆ
    password_length.times do
      tmp_password += chars[SecureRandom.random_number(chars.size)]
    end
    # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®è¦ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ã‹ç¢ºèª
    tmp_password.split("").each do |c|
      is_lower = chars_lower.include?(c) ? true : is_lower
      is_upper = chars_upper.include?(c) ? true : is_upper
      is_number = chars_number.include?(c) ? true : is_number
      is_special = chars_special.include?(c) ? true : is_special
    end

    if is_lower && is_upper && is_number && is_special
      return tmp_password
    end
  end
end
```

å…ˆã»ã©ã‚ã’ãŸã‚³ãƒ¼ãƒ‰ã‹ã‚‰ `array.sample` ã§æ–‡å­—ã‚’æŠ½å‡ºã—ã¦ã„ãŸéƒ¨åˆ†ã‚’ `random_number` ãƒ¡ã‚½ãƒƒãƒ‰ã§æ•°å€¤ã‚’ç”Ÿæˆã—ã€ãã®æ•°å€¤ã‚’é…åˆ—ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨ã™ã‚‹ã“ã¨ã§æ–‡å­—ã‚’æŠ½å‡ºã—ã¦ã„ã¾ã™ã€‚

# ã•ã„ã”ã«
ã”æ„è¦‹ã‚„ã‚‚ã£ã¨ã„ã„æ–¹æ³•ã‚’ã”å­˜ã˜ã®æ–¹ã¯ãœã²æ•™ãˆã¦ãã ã•ã„ï¼

# å‚è€ƒ

https://docs.ruby-lang.org/ja/latest/class/SecureRandom.html
https://docs.ruby-lang.org/ja/latest/class/SecureRandom.html