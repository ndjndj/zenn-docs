---
title: "ActiveRecord ã§ integer å‹ã‚«ãƒ©ãƒ ã®æ•°å€¤ç¯„å›²ã«åˆ¶é™ã‚’ã‹ã‘ã‚‹"
emoji: "ğŸ°"
type: "tech"
topics:
  - "rails"
  - "ruby"
  - "activerecord"
published: true
published_at: "2024-03-06 18:31"
---

Rails ã® ActiveRecord ã§ã€æ•°å€¤å‹ã®ã‚«ãƒ©ãƒ ã«å¯¾ã—ã¦æ•°å€¤ç¯„å›²ã®åˆ¶é™ã‚’ã‹ã‘ã‚‹æ–¹æ³•ã«ã¤ã„ã¦å‚™å¿˜éŒ²ã¨ã—ã¦ã¾ã¨ã‚ã¾ã™ã€‚

# çµè«–
- migration ãƒ•ã‚¡ã‚¤ãƒ«ã§æŒ‡å®šã™ã‚‹ limit ã¯å¤§ãã•ã§ã¯ãªããƒã‚¤ãƒˆæ•°
- Model å´ã§ numericality validates ã‚’è¨­å®šã—ãŸã»ã†ãŒã‚ˆã•ã’
- æœ‰åŠ¹/ç„¡åŠ¹ ã®ã‚ˆã†ãªæ•°ç¨®é¡ã®ãƒ•ãƒ©ã‚°ã‚„é¸æŠå¼ã®å€¤ã‚’ç®¡ç†ã™ã‚‹ãªã‚‰ã€enum ã®æ–¹ãŒã‚ã‹ã‚Šã‚„ã™ã„

# ã‚„ã‚ŠãŸã‹ã£ãŸã“ã¨
ãƒ¢ãƒ‡ãƒ«åã‚„ã‚«ãƒ©ãƒ åã¯æ¶ç©ºã®ã‚‚ã®ã§ã™ãŒã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã€integer å‹ã®ã‚«ãƒ©ãƒ (:age, :account_status)ã«å…¥ã‚‹æ•°å€¤ã«ä»¥ä¸‹ã®ã‚ˆã†ãªæ•°å€¤ç¯„å›²ã®åˆ¶é™ã‚’ã‹ã‘ãŸã‹ã£ãŸã®ã§ã™ã€‚

|ã‚«ãƒ©ãƒ |åˆ¶é™|
|-|-|
|age|0 ï½ 19 ã¾ã§ç™»éŒ²å¯èƒ½|
|account_status|0 ãªã‚‰ç„¡åŠ¹ã€1 ãªã‚‰æœ‰åŠ¹|

```ruby
class CreateChirdren < ActiveRecord::Migration[7.1]
  def up
    create_table :chirdren do |t|
      t.string :email, :null => false, comment: "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"
      t.string :name, :null => false, comment: "åå‰"
      t.integer :age, default: 0, comment: "å¹´é½¢"
      t.integer :account_status, comment: "ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæœ‰åŠ¹æ€§(0: ç„¡åŠ¹, 1: æœ‰åŠ¹)"
      t.timestamps
    end
  end

  def down
    drop_table :children
  end
end
```

# migration ãƒ•ã‚¡ã‚¤ãƒ«ã§æŒ‡å®šã™ã‚‹ limit ã¯å¤§ãã•ã§ã¯ãªããƒã‚¤ãƒˆæ•°
å½“åˆã€ä¸‹è¨˜ã®ã‚ˆã†ã« migration ãƒ•ã‚¡ã‚¤ãƒ«ã§ã€limit ã§æœ€å¤§ã®æ•°ã‚’æŒ‡å®šã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã—ãŸã€‚

```ruby
  t.integer :age, default: 0, limit: 19, comment: "å¹´é½¢"
```

ã“ã‚Œã¯é–“é•ã„ã§ã€ã“ã®å ´åˆã€age ã‚«ãƒ©ãƒ ã¯ 19 ãƒã‚¤ãƒˆã®åˆ¶é™ã‚’ã‹ã‘ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

https://railsguides.jp/active_record_migrations.html#%E3%82%AB%E3%83%A9%E3%83%A0%E4%BF%AE%E9%A3%BE%E5%AD%90

# Model å´ã§ numericality validates ã‚’è¨­å®šã—ãŸã»ã†ãŒã‚ˆã•ã’
ãªã®ã§ã€migration ãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ãªãã€Model å´ã§åˆ¶é™ã‚’ã‹ã‘ã¾ã™ã€‚
numericality ãƒ˜ãƒ«ãƒ‘ãƒ¼ã«ã€æ•°å€¤ç¯„å›²ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§åˆ¶ç´„ã‚’ã‹ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```ruby
class Children < ApplicationRecord
  validates :age, numericality: { greater_than_or_equal_to: 0, less_than_or_equal_to: 19 }
end
```

ä¸Šè¨˜ã®ä¾‹ã§ã¯ã€`ä»¥ä¸Š`ãƒ»`ä»¥ä¸‹`ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§è¨­å®šã—ã¾ã—ãŸãŒã€`è¶…é`ãƒ»`æœªæº€`ã‚‚ãã‚Œãã‚Œã€`grater_than`, `less_than` ã®ã‚ˆã†ã«è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¾ãŸã€Rails 7 ãªã‚‰ä¸‹è¨˜ã®ã‚ˆã†ã«ã€`in` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã« range ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¸¡ã—ã¦ã‚·ãƒ³ãƒ—ãƒ«ã«è¨˜è¿°ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

```ruby
class Children < ApplicationRecord
  validates :age, numericality: { in: 0..19 }
end
```

https://railsguides.jp/active_record_validations.html#numericality

# æœ‰åŠ¹/ç„¡åŠ¹ ã®ã‚ˆã†ãªæ•°ç¨®é¡ã®ãƒ•ãƒ©ã‚°ã‚„é¸æŠå¼ã®å€¤ã‚’ç®¡ç†ã™ã‚‹ãªã‚‰ã€enum ã®æ–¹ãŒã‚ã‹ã‚Šã‚„ã™ã„
ã¾ãŸã€æœ‰åŠ¹/ç„¡åŠ¹ã®2ã¤ã®å€¤ã—ã‹ã¨ã‚‰ãªã„ãƒ‡ãƒ¼ã‚¿ã‚„ã€æœ‰æ–™/ç„¡æ–™ãƒ—ãƒ©ãƒ³(æœ‰æ–™ã§ã‚‚æ¾ç«¹æ¢…ã®ã‚ˆã†ã«ã„ãã¤ã‹åˆ†ã‹ã‚Œã¦ã„ã‚‹å ´åˆã‚‚ã‚ã‚Šã¾ã™ã‚ˆã­)ã®ã‚ˆã†ãªé¸æŠå¼ã®å€¤ã‚’ integer å‹ã‚«ãƒ©ãƒ ã§ç®¡ç†ã™ã‚‹å ´åˆã¯ã€enum ã§ç®¡ç†ã™ã‚‹æ–¹ãŒå€‹äººçš„ã«ã¯ã‚ã‹ã‚Šã‚„ã™ã„ã‹ãªã¨æ€ã„ã¾ã™ã€‚

```ruby
class Children < ApplicationRecord
  enum :account_status, { ban: 0, active: 1 }
end
```

# å‚è€ƒ
https://railsguides.jp/active_record_migrations.html#%E3%82%AB%E3%83%A9%E3%83%A0%E4%BF%AE%E9%A3%BE%E5%AD%90
https://railsguides.jp/active_record_validations.html#numericality