---
title: "Rails ã§ è¤‡æ•°ã® Serializer ã‚’çµ„ã¿åˆã‚ã›ã‚‹"
emoji: "ğŸ°"
type: "tech"
topics:
  - "rails"
  - "ruby"
  - "activerecord"
published: true
published_at: "2024-04-18 10:53"
---

Rails ã§ API ã‚’é–‹ç™ºã—ã¦ã„ã¾ã™ã€‚
**ã‚ã‚‹ã‚­ãƒ¼ã®å€¤ãŒã‚ã‚‹ãƒ¢ãƒ‡ãƒ«ã‚’ Serialize ã—ãŸçµæœã§ã‚ã‚‹ã‚ˆã†ãª**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã—ãŸã„ã¨ãã® Serializer ã®å®Ÿè£…ã«ã¤ã¾ã¥ã„ãŸã®ã§ã€è§£æ±ºç­–ã‚’å‚™å¿˜éŒ²ã¨ã—ã¦ã¾ã¨ã‚ã¾ã™ã€‚

# çµè«–
- ActiveModelSerializers::SerializableResource.new ã‚’ä½¿ã†

# ã‚„ã‚ŠãŸã„ã“ã¨ã¨å‰æ
user_posts_controller.rb ã® show ãƒ¡ã‚½ãƒƒãƒ‰ã§ã€ä¸Šè¿°ã—ãŸã‚ˆã†ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã—ãŸã„ã€‚

posts ã‚­ãƒ¼ã®ä¸­èº«ã¯ **Post ãƒ¢ãƒ‡ãƒ«ãŒ PostsSerializer ã«ã‚ˆã£ã¦ Serialize ã•ã‚ŒãŸé…åˆ—**ã‚’è¿”ã—ãŸã„ã€‚
ã¾ãŸã€ã™ã§ã« PostsSerializer ã¯å®Ÿè£…ã•ã‚Œã¦ãŠã‚Šã€åˆ¥ã® Controller ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã€‚
posts ã‚­ãƒ¼ä»¥å¤–ã¯ User ãƒ¢ãƒ‡ãƒ«ã® attribute ã¨ãªã£ã¦ãŠã‚Šã€posts ã¨åŒä¸€ã®éšå±¤ã§è¿”ã—ãŸã„[^1]ã€‚
ã“ã®ã¨ãã€User ã‚’ Serialize ã—ã€ã•ã‚‰ã« Posts ã‚‚ Serialize ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
User ãƒ¢ãƒ‡ãƒ«ã¨ Post ãƒ¢ãƒ‡ãƒ«ã¯åŒä¸€éšå±¤ã«ä½ç½®ã—ã¦ã„ã‚‹ãŸã‚ã€Serializer ã‚’ãƒã‚¹ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€ãã®æ–¹æ³•ãŒã‚ã‹ã‚‰ãšå›°ã£ã¦ã¾ã—ãŸã€‚

```json
{
    "name": "ãªã¾ãˆ", 
    "age": 24,
    "address": "----",
    "posts": [
        // Post ãƒ¢ãƒ‡ãƒ«ãŒã€PostsSerializer ã«ã‚ˆã£ã¦ Serialize ã•ã‚ŒãŸã‚„ã¤ã®é…åˆ—
        // (çœç•¥)
    ]
}
```

# è§£æ±ºç­–
Serializer å†…ã§ã€Serializer ã‚’å‘¼ã³å‡ºã›ã‚‹ã®ã§ãã®ã‚ˆã†ãªãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã™ã‚‹

**user_posts_controller.rb**
```rb
def show
# ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹å‡¦ç†ã¯çœç•¥ã™ã‚‹

results = { user: user, posts: posts }

render json: results, serializer: UserPostsSerializer
end
```

**user_posts_serializer.rb**
```rb
class UserPostsSerializer < ActiveModel::Serializer
  attribute :name, :age, :address
  attribute :posts

  def name
    object[:user][:name]
  end

  def age
    object[:user][:age]
  end

  def address
    object[:user][:address]
  end

  def posts
    ActiveModelSerializers::SerializableResource.new(
      object[:posts], each_serializer: PostsSerializer
    ).as_json
  end
end
```

# ã•ã„ã”ã«
ä»–ã«ã‚ˆã‚Šã‚ˆã„æ–¹æ³•ãŒã‚ã‚Œã°ã”æŒ‡æ‘˜ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚

[^1]: user ã‚­ãƒ¼ã‚’ä½¿ã£ã¦ãƒã‚¹ãƒˆã•ã›ãŸæ–¹ãŒã„ã„ã¨æ€ã„ã¾ã™ãŒã€Serializer ã®æ•°ãŒå¢—ãˆã¦ã—ã¾ã†ã®ã§ã€ç°¡ç•¥åŒ–ã®ãŸã‚ã«åŒä¸€éšå±¤ã¨ã—ã¦ã„ã¾ã™ã€‚