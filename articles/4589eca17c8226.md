---
title: "ã€Dynamoid ã§ STIã€‘è¤‡æ•°ã®ã‚¯ãƒ©ã‚¹ã‚’ä¸€ã¤ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã¾ã¨ã‚ã‚‹"
emoji: "ğŸ°"
type: "tech"
topics:
  - "aws"
  - "rails"
  - "ruby"
  - "dynamodb"
published: true
published_at: "2024-02-06 20:36"
---

Ruby on Rails ã§ DynamoDB ã‚’ ActiveRecord ã®ã‚ˆã†ã«æ‰±ãˆã‚‹ Dynamoid ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚
Users ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¢ã‚¤ãƒ†ãƒ ãŒå…¥ã£ã¦ã„ãŸã¨ãã€Rails å´ã§ Users ã‚¯ãƒ©ã‚¹ã¨ã—ã¦å–ã‚Šæ‰±ã†ã®ãŒå°‘ã—è¤‡é›‘ã«ãªã‚Šãã†ã ã£ãŸã®ã§ã€ãªã‚“ã¨ã‹ãªã‚‰ãªã„ã‹ã¨æ€ã„èª¿ã¹ã¾ã—ãŸã€‚

|pk|sk|èª¬æ˜|
|-|-|-|
|U_#id|item_#item_id1|ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¿æŒã‚¢ã‚¤ãƒ†ãƒ |
|U_#id|item_#item_id2|ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¿æŒã‚¢ã‚¤ãƒ†ãƒ |
|U_#id|skill_#skill_id1|ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ã‚­ãƒ«|
|U_#id|skill_#skill_id2|ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ã‚­ãƒ«|
|U_#id|weakpoint|å¼±ç‚¹|

# è¦ç´„
- STI(å˜ä¸€ãƒ†ãƒ¼ãƒ–ãƒ«ç¶™æ‰¿)ã‚’ä½¿ã†
- model ã« type field ã‚’è¿½åŠ ã™ã‚‹

# STI(å˜ä¸€ãƒ†ãƒ¼ãƒ–ãƒ«ç¶™æ‰¿)ã‚’ä½¿ã†
STI ã¨ã¯ Single Table Inheritance ã®ç•¥ã§å˜ä¸€ãƒ†ãƒ¼ãƒ–ãƒ«ç¶™æ‰¿ã®ç•¥ã ãã†ã§ã™ã€‚

https://ja.wikipedia.org/wiki/%E5%8D%98%E4%B8%80%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E7%B6%99%E6%89%BF

https://railsguides.jp/association_basics.html#%E5%8D%98%E4%B8%80%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E7%B6%99%E6%89%BF-%EF%BC%88sti%EF%BC%89

ã‚‚ã¨ã‚‚ã¨ã¯ã€ä¸€ã¤ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰è¤‡æ•°ç¨®é¡ã®ã‚¯ãƒ©ã‚¹ã‚’æ‰±ã†ãŸã‚ã« ActiveRecord ã§ç”¨æ„ã•ã‚Œã¦ã„ãŸä»•çµ„ã¿ã§ã™ãŒã€Dynamoid ã§ã‚‚åŒã˜ä»•çµ„ã¿ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚

# model ã« type field ã‚’è¿½åŠ ã™ã‚‹
ä½¿ã„æ–¹ã¯å˜ç´”ã« model ã« type ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã ã‘ã§ã™ã€‚

```ruby
class User
  include Dynamoid::Document

  table name: :user, key: :pk, read_capacity: 5, write_capacity: 5
  range :sk, :string
  field :type # <- ã“ã‚Œã‚’ã¤ã„ã‹ã™ã‚‹

end

class UserItem < User
  field :item_id, :string
  field :item_name, :string
end

class UserSkill < User
  field :skill_id, :string
  field :skill_name, :string
  field :damage_alg, :string
end
```

# inheritance_field: ã§ç«¶åˆã‚’å›é¿
æ—¢ã« type field ãŒãƒ†ãƒ¼ãƒ–ãƒ«ã«å­˜åœ¨ã—ã¦ã„ã‚‹å ´åˆãªã©ã§ type field ã‚’ä½¿ç”¨ã—ãŸããªã„å ´åˆã¯ã€inheritance_field: ã§å›é¿ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```ruby
class User
  include Dynamoid::Document

  table name: :user, key: :pk, inheritance_field: :sti_type 
  range :sk, :string
  field :sti_type, :string
end

class UserItem < User
  field :item_id, :string
  field :item_name, :string
end

class UserSkill < User
  field :skill_id, :string
  field :skill_name, :string
  field :damage_alg, :string
end
```

# æœ€å¾Œã«
ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¦‹ã‚Œã°ã™ãã«ã‚ã‹ã‚‹ã“ã¨ã§ã™ãŒã€STI ã‹ã‚‰ã®ã¤ãªãŒã‚Šã‚’ç†è§£ã™ã‚‹ãŸã‚ã«ã¾ã¨ã‚ã¾ã—ãŸã€‚
DynamoDB ã§ã¯ä»Šå›ã®ä¾‹ã®ã‚ˆã†ã«ã€ä¸€ã¤ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã§ã„ã‚ã„ã‚ãªã‚¿ã‚¤ãƒ—ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ ¼ç´ã™ã‚‹ã“ã¨ãŒå¤šã„ã®ã§ã€STI ã‚’ç”¨ã„ã‚‹ã®ãŒåŠ¹æœçš„ã§ã‚ˆãä½¿ã†ã“ã¨ã«ãªã‚Šãã†ã§ã™ã€‚

# å‚è€ƒ
https://ja.wikipedia.org/wiki/%E5%8D%98%E4%B8%80%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E7%B6%99%E6%89%BF
https://railsguides.jp/association_basics.html#%E5%8D%98%E4%B8%80%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E7%B6%99%E6%89%BF-%EF%BC%88sti%EF%BC%89
https://github.com/Dynamoid/dynamoid
