---
title: "ã€Ruby on Railsã€‘good_job ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ API ãƒ¢ãƒ¼ãƒ‰ã§ä½¿ã†"
emoji: "ğŸ°"
type: "tech"
topics:
  - "rails"
  - "ruby"
  - "goodjob"
published: true
published_at: "2024-02-13 11:05"
---

Rails ã§ API ã‚’é–‹ç™ºã—ã¦ã„ã¾ã™ã€‚
éåŒæœŸå‡¦ç†ã®ãŸã‚ã«ã€good_job ã‚’å°å…¥ã—ãŸã®ã§ã™ãŒã€good_job ã®ç‰¹å¾´ã®ä¸€ã¤ã§ã‚ã‚‹ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã«ã¯ã€API ãƒ¢ãƒ¼ãƒ‰ã§ã¯è¨­å®šãŒå¿…è¦ã ã£ãŸã®ã§ã€å‚™å¿˜éŒ²ã‚’æ®‹ã—ã¾ã™ã€‚

# routes.rb ã§ route ã‚’è¨­å®š
ã“ã“ã¯ã€API ãƒ¢ãƒ¼ãƒ‰ã¨ã‹ã¯é–¢ä¿‚ãªã„æ™®éçš„ãªè¨­å®šã§ã™ã€‚
ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã® route ã‚’è¨­å®šã—ã¾ã™ã€‚

```ruby
# app/config/routes.rb

Rails.application.routes.draw do
    namespace :admin do
        require 'good_job/engine'
        mount GoodJob::Engine => 'good_job'
    end
end 
```

# application.rb ã«è¨­å®šã‚’è¿½åŠ ã™ã‚‹
API ãƒ¢ãƒ¼ãƒ‰ã«è¶³ã‚Šãªã„è¨­å®šã‚’è¿½åŠ ã—ã¾ã™ã€‚

```ruby
# config/application.rb

module AppName
    class Application < Rails::Application
        # Initialize configuration defaults for originally generated Rails version.
        config.load_defaults 7.1

        # ~~~~~~~~~(ä¸­ç•¥)~~~~~~~~~

        # ä»¥ä¸‹ã‚’è¿½åŠ 
        config.middleware.use Rack::MethodOverride
        config.middleware.use ActionDispatch::Flash
        config.middleware.use ActionDispatch::Cookies
        config.middleware.use ActionDispatch::Session::CookieStore
    end
end
```

ã“ã“ã¾ã§è¨­å®šã™ã‚Œã°ã€API ãƒ¢ãƒ¼ãƒ‰ã§ã‚‚ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ã¯ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã¯ãšã§ã™ã€‚

# (ãŠã¾ã‘) ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãƒ™ãƒ¼ã‚·ãƒƒã‚¯èªè¨¼ã‚’è¿½åŠ ã™ã‚‹
job ã«ã¯ã€æ©Ÿå¯†æƒ…å ±ãŒå«ã¾ã‚Œã‚‹ã“ã¨ãŒå¤šã„ãŸã‚ã€good_job å…¬å¼ã§ã‚‚èªè¨¼æ©Ÿæ§‹ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¦ã„ã¾ã™ã€‚
devise ãªã©ã‚’ç”¨ã„ã¦ã‚‚ã„ã„ã®ã§ã™ãŒã€ä»Šå›ã¯ç°¡æ˜“çš„ã«ãƒ™ãƒ¼ã‚·ãƒƒã‚¯èªè¨¼ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```ruby
# config/initializers/good_job.rb

Rails.application.configure do
  GoodJob::Engine.middleware.use(Rack::Auth::Basic) do |username, password|
    ActiveSupport::SecurityUtils.secure_compare(
      Rails.application.credentials.good_job[:username], username
    ) &&
    ActiveSupport::SecurityUtils.secure_compare(
      Rails.application.credentials.good_job[:password], password
    )
  end
end
```

## credentials.yml.enc ã« username, password ã‚’è¨­å®šã™ã‚‹
credential ã‚’ç·¨é›†ã—ã¾ã™ã€‚

```bash
    EDITOR="vi" bin/rails credentials:edit
```

ä¸‹è¨˜ã®ã‚ˆã†ãªæ§‹æˆã§ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚

```yml
good_job:
    username: foo
    password: barbaz
```
ã“ã®ã‚ˆã†ã«è¨­å®šã™ã‚‹ã“ã¨ã§ã€
Rails ä¸Šã§ã€`Rails.application.credentials.good_job[:username]` ã®ã‚ˆã†ãªå½¢ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

# å‚è€ƒ
https://github.com/bensheldon/good_job?tab=readme-ov-file#api-only-rails-applications
https://qiita.com/NaokiIshimura/items/2a179f2ab910992c4d39

