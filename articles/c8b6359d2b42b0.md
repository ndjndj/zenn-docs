---
title: "ã€Dockerã€‘å…¨æ–‡æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ Meilisearch ã®é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹"
emoji: "ğŸï¸"
type: "tech"
topics:
  - "docker"
  - "meilisearch"
published: true
published_at: "2024-01-10 12:09"
---

ç¾åœ¨é–‹ç™ºä¸­ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã€æ¤œç´¢æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚
æ¤œç´¢æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã«ã¯ `RDB` ã®ã‚ã„ã¾ã„æ¤œç´¢æ©Ÿèƒ½(`SQL` ã® `LIKE` å¥)ã‚’ä½¿ã†ä»¥å¤–ã«ã‚‚ã€`Elasticsearch`ã€`Solr`ã€`Amazon CloudSearch`ã€`Amazon OpenSearch Service`ã€`Algolia`ã€`Meilisearch` ãªã©ã®å…¨æ–‡æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã‚’ä½¿ã†æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚

ä»Šå›ã¯ã€ä¾¡æ ¼é¢(ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãŒå¯èƒ½)ã¨å­¦ç¿’ã‚³ã‚¹ãƒˆ(ã‚·ãƒ³ãƒ—ãƒ«ãª API)ã€å®Ÿè£…ã—ãŸã„æ©Ÿèƒ½(ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ãƒˆæ¤œç´¢)ã«å¯¾ã™ã‚‹æ€§èƒ½ãªã©ã®é¢ã‹ã‚‰ `Meilisearch` ã‚’é¸æŠã—ãŸã®ã§ã€ã¨ã‚Šã‚ãˆãš `Docker` ã§é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

# ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
ã‚³ãƒ¼ãƒ‰ãªã©ã¯ã“ã“ã‹ã‚‰ç¢ºèªã§ãã¾ã™ã€‚

https://github.com/ndjndj/playground/tree/main/meili-docker

# ã“ã®è¨˜äº‹ã§ã‚„ã‚‹ã“ã¨
- `Meilisearch` ã«ã¤ã„ã¦è»½ãç´¹ä»‹
- `Docker` ã‚’ç”¨ã„ãŸ `Meilisearch` ã®é–‹ç™ºç’°å¢ƒã®æ§‹ç¯‰
- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ä½œæˆ
- API ã‚’å©ã„ã¦ã¿ã‚‹

# ã“ã®è¨˜äº‹ã§ã‚„ã‚‰ãªã„ã“ã¨
- `Elasticsearch`, `Amazon OpenSearch Service`, `Algolia` ãªã©ã®ä»–ã®å…¨æ–‡æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã¨ã®æ¯”è¼ƒ
- `Meilisearch cloud` ã®ä½¿ç”¨æ–¹æ³•
- `Meilisearch` ã‚’ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹æ–¹æ³•
	- `AWS EC2` ã¸ã®ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã«ã¤ã„ã¦åˆ¥è¨˜äº‹ã§ç´¹ä»‹ã™ã‚‹äºˆå®š

# Meilisearch ã«ã¤ã„ã¦
`Meilisearch` ã¯ `Meilisearch` ç¤¾ã«ã‚ˆã£ã¦é–‹ç™ºã•ã‚Œã¦ã„ã‚‹ `Rust` è£½ã®å…¨æ–‡æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã§ã™ã€‚

[ãƒ‡ãƒ¢ã‚µã‚¤ãƒˆ](https://where2watch.meilisearch.com/)ã¯ã“ã¡ã‚‰ã‹ã‚‰ã€‚

å†’é ­ã§ã‚‚è¿°ã¹ãŸã¨ãŠã‚Šã€ã‚·ãƒ³ãƒ—ãƒ«ãª API ã¨æ¤œç´¢æ©Ÿèƒ½ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®é«˜ã•ã€çœãƒ¡ãƒ¢ãƒªã§ã‚ã‚‹ã“ã¨ãªã©ã®ç‚¹ã«é­…åŠ›ã‚’æ„Ÿã˜ã¦ `Meilisearch` ã®å°å…¥ã‚’æ±ºã‚ã¾ã—ãŸã€‚
ä¸€æ–¹ã§ç´°ã‹ã„ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚„æ—¥æœ¬èªæ¤œç´¢ã«ã¤ã„ã¦ã¯ã¾ã è‹¦æ‰‹ã¨ã®ã“ã¨ã§ã™ã€‚
è©³ç´°ã¯[ã“ã¡ã‚‰](https://qiita.com/mosuka/items/fbda479b25a7ccd7c350)ã®è¨˜äº‹ã‚„[ã“ã¡ã‚‰](https://blog.meilisearch.com/meilisearch-vs-elasticsearch/), [ã“ã¡ã‚‰](https://www.meilisearch.com/docs/learn/what_is_meilisearch/comparison_to_alternatives)ã®è¨˜äº‹ãŒéå¸¸ã«ã‚ã‹ã‚Šã‚„ã™ã„ã§ã™ã€‚

# Docker ã§ç’°å¢ƒæ§‹ç¯‰ã—ã¦ã¿ã‚‹
`Meilisearch` ã®å…¬å¼ã‹ã‚‰ `docker image` ãŒæä¾›ã•ã‚Œã¦ã„ã‚‹ã®ã§ãã¡ã‚‰ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

```yml
# compose.yml
version: '3'
services: 
  meilisearch: 
    image: getmeili/meilisearch:v1.5 # ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ä»»æ„
    ports:
      - "7700:7700"
    environment: # ã‚ã¨ã§ã¤ã‹ã„ã¾ã™(æœ¬ç•ªç’°å¢ƒã§ã¯ã‚‚ã£ã¨è¤‡é›‘ãªã‚­ãƒ¼ã‚’ä½¿ç”¨ã—ã¾ã™)
      - MEILI_MASTER_KEY=meili-master-key
    volumes: # ãƒ‡ãƒ¼ã‚¿éƒ¨åˆ†ã‚’ãƒã‚¦ãƒ³ãƒˆã™ã‚‹
      - ./meili_data:/meili_data
```

## èµ·å‹•

```bash
docker compose up
```

## ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ã«å…¥ã£ã¦ã¿ã‚‹
ä½œæˆã—ãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‹ã‚‰æ¤œç´¢æ©Ÿèƒ½ã‚’ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã«ãƒ†ã‚¹ãƒˆã™ã‚‹ã“ã¨ãŒã§ãã‚‹ç”»é¢ã§ã™ã€‚
API ã‚­ãƒ¼ã®å…¥åŠ›ã‚’æ±‚ã‚ã‚‰ã‚Œã‚‹ã®ã§ã€`compose.yml` ã§è¨­å®šã—ãŸã‚­ãƒ¼ã‚’å…¥åŠ›

![](https://storage.googleapis.com/zenn-user-upload/6eec856b99f0-20240110.png)

æ¬¡ã¯ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¦ã€æ¤œç´¢æ©Ÿèƒ½ã‚’è©¦ã—ã¦ã¿ã¾ã™ã€‚

# ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ
ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã® `json` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€`Meilisearch` ã® API çµŒç”±ã§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚
ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã¯ã€`RDB` ã§ã„ã†ã¨ãƒ¬ã‚³ãƒ¼ãƒ‰ã§ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨ã¯ãƒ†ãƒ¼ãƒ–ãƒ«ã¿ãŸã„ãªã‚‚ã®ã§ã™ã€‚
`Meilisearch` ã§ã¯ã€ã²ã¨ã¤ã²ã¨ã¤ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã‚ˆã³ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨ã‚ˆã‚“ã§ã„ã¾ã™ã€‚

## ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã® json ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ

ä»Šå›ã¯ `user` ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚
ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã¯[ã“ã¡ã‚‰](https://tm-webtools.com/Tools/TestData)ã‹ã‚‰ã€ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ã¯10ä¸‡ä»¶ä½œæˆã—ã¾ã—ãŸã€‚

```json
[
    {
        "uid": "100000",
        "name": "å±±ç”°ã€€å¤ªéƒ",
        "name_ruby": "yamada taro",
        "age": "7",
        "pref": "èŒ¨åŸçœŒ",
        "pref_code": "08",
        "tel": "090-0000-0000",
        "url": "http://example.com"
    }
]
```

## API çµŒç”±ã§ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ

ä¸‹è¨˜ã® `curl` ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€API ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚(`'`, `"` ã®é•ã„ãªã©ã¯é©å®œä¿®æ­£ã—ã¦ãã ã•ã„)

```bash
# ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿.json ãŒã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§å®Ÿè¡Œã™ã‚‹
curl \
  -X POST 'http://localhost:7700/indexes/{ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å}/documents?primaryKey={ä»»æ„ã®ã‚­ãƒ¼}' \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer meili-master-key' \
  --data-binary @sample.json
  
# ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”¨  
curl -X POST "http://localhost:7700/indexes/{ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å}/documents?primaryKey={ä»»æ„ã®ã‚­ãƒ¼}" -H "Content-Type: application/json" -H "Authorization: Bearer meili-master-key" --data-binary @sample.json
```

ä¸‹è¨˜ã®ã‚ˆã†ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã£ã¦ãã‚Œã°æˆåŠŸã§ã™ã€‚
`Meilisearch` ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã®ã»ã¨ã‚“ã©ãŒéåŒæœŸã§ã‚ã‚‹ãŸã‚ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆã™ã‚‹ä¸Šè¨˜ã®æ“ä½œã¯ä¸€åº¦ã€ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ ã•ã‚Œé †ç•ªã«å®Ÿè¡Œã•ã‚Œã¦ã„ãã¾ã™ã€‚
`status` ãŒ `enqueued` ã‚’ç¤ºã—ã¦ã„ã‚Œã°ã€ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ ã•ã‚ŒãŸã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

```json
{
	"taskUid":0,
	"indexUid":"users",
	"status":"enqueued",
	"type":"documentAdditionOrUpdate",
	"enqueuedAt":"2024-01-10T02:27:06.751515253Z"
}
```

## ä½œæˆçŠ¶æ³ã®ç¢ºèª

`taskUid` ã‚’æŒ‡å®šã—ã¦ã€ä¸‹è¨˜ã® `curl` ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€API ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚(`'`, `"` ã®é•ã„ãªã©ã¯é©å®œä¿®æ­£ã—ã¦ãã ã•ã„)

```bash
curl \
  -X GET 'http://localhost:7700/tasks/0' \
  -H 'Authorization: Bearer meili-master-key'
  
# ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”¨  
curl -X GET "http://localhost:7700/tasks/0" -H "Authorization: Bearer meili-master-key"
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã® `status` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒ `succeeded` ã‚’ç¤ºã—ã¦ã„ã‚Œã°æˆåŠŸã§ã™ã€‚

```json
{
	"uid":0,
	"indexUid":"users",
	"status":"succeeded",
	"type":"documentAdditionOrUpdate",
	"canceledBy":null,
	"details":{
		"receivedDocuments":100000,
		"indexedDocuments":100000
	},
	"error":null,
	"duration":"PT24.046323975S",
	"enqueuedAt":"2024-01-10T02:27:06.751515253Z",
	"startedAt":"2024-01-10T02:27:06.79580607Z",
	"finishedAt":"2024-01-10T02:27:30.842130045Z"
}
```

## ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ã§ã®ç¢ºèª
ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ã‚’æ›´æ–°ã—ã¦ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/f5fa621a173c-20240110.png)

# API ã‚’å©ã„ã¦ã¿ã‚‹

## æ¤œç´¢
ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒä½œæˆã•ã‚ŒãŸã“ã¨ãŒç¢ºèªã§ããŸã‚‰ã€API çµŒç”±ã§æ¤œç´¢ã—ã¦ã¿ã¾ã™ã€‚

ä¸‹è¨˜ã® `curl` ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€API ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚(`'`, `"` ã®é•ã„ãªã©ã¯é©å®œä¿®æ­£ã—ã¦ãã ã•ã„)

```bash
curl \
  -X POST 'http://localhost:7700/indexes/{ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å}/search' \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer meili-master-key' \
  --data-binary '{ "q": "{æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰}" }'
  
# ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”¨  
curl -X POST "http://localhost:7700/indexes/{ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å}/search" -H "Content-Type: application/json" -H "Authorization: Bearer meili-master-key" --data-binary "{ \"q\": \"{æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰}\" }"
```

## ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®å‰Šé™¤
`DELETE` ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åã‚’æŒ‡å®šã™ã‚Œã°ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
éå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã€‚

```bash
curl \
  -X DELETE 'http://localhost:7700/indexes/{ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å}' \
  -H 'Authorization: Bearer meili-master-key'
  
# ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”¨
curl -X DELETE "http://localhost:7700/indexes/{ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å}" -H "Authorization: Bearer meili-master-key"
```

# ã•ã„ã”ã«
ã“ã‚Œã§ `Docker` ã‚’ç”¨ã„ãŸ `Meilisearch` ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®é–‹ç™ºç’°å¢ƒã‚’æ•´ãˆã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
`Meilisearch` ã§ã¯ã€æ§˜ã€…ãªè¨€èªã§åˆ©ç”¨ã™ã‚‹ãŸã‚ã® SDK ã‚‚å……å®Ÿã—ã¦ãŠã‚Šã€å®Ÿè£…ã‚‚ã‚¹ãƒ ãƒ¼ã‚ºã«ã§ããã†ã§ã™ã€‚

https://github.com/meilisearch/integration-guides

# å‚è€ƒ

## Meilisearch ã«ã¤ã„ã¦
https://qiita.com/mosuka/items/fbda479b25a7ccd7c350
https://blog.meilisearch.com/meilisearch-vs-elasticsearch/
https://www.meilisearch.com/docs/learn/what_is_meilisearch/comparison_to_alternatives

## Docker ã§ã®ç’°å¢ƒæ§‹ç¯‰
https://www.meilisearch.com/docs/learn/cookbooks/docker
https://zenn.dev/shiguredo/articles/docker-compose-timescaledb-meilisearch

## ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ
https://www.meilisearch.com/docs/learn/getting_started/quick_start

## ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆã«ä½¿ç”¨ã—ãŸãƒ„ãƒ¼ãƒ«
https://tm-webtools.com/Tools/TestData

## SDK ã«ã¤ã„ã¦
https://github.com/meilisearch/integration-guides